<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>海拥 | 盖塔楼</title>
    <meta name="viewport" content="width=device-width,user-scalable=no">
    <meta name="keywords" content="盖塔楼" />
    <meta name="description" content="盖塔楼" /> 
    <meta name="author" content="海拥(http://haiyong.site)" />
    <meta name="copyright" content="海拥(http://haiyong.site)" />
    <link rel="stylesheet" href="css/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="js/telegram.js" type="text/javascript" charset="utf-8"></script>

</head>
<body>		
    <!-- <div id="container">
        <div id="game"></div>
        <div id="score">0</div>
        <div id="instructions">单击(或按空格)放置砖块</div>
        <div class="game-over">
            <h2>Game Over</h2>
            <p>你做的很好啦,你是最棒的</p>
            <p>单击或按空格重新开始</p>
        </div>
        <div class="game-ready">
            <div id="start-button">开始1</div>
        </div>
      
    </div> -->
    <h1>Welcome to Telegram Mini App</h1>
    <div id="user-info"></div>
    <!-- Telegram 登录按钮
    <script async src="https://telegram.org/js/telegram-widget.js?22" 
            data-telegram-login="XiangNan2_bot" 
            data-size="large" 
            data-onauth="onTelegramAuth(user)">
    </script> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
    <!-- <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="XiangNan2_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
    <script type="text/javascript">
      function onTelegramAuth(user) {
        alert('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');
      }
    </script> -->

    <script>
        // 初始化 Telegram Web App
        Telegram.WebApp.ready();

    
       const userInfo =  getUserInfo();

        const userInfoElement = document.getElementById('user-info');
        if (userInfo.user_id) {
            const userInfoString =  JSON.parse( localStorage.getItem('userInfo'))
            userInfoElement.innerHTML = `
            <p>localStorage: ${userInfoString.first_name}</p>

            <p>query_id: ${userInfo.query_id}</p>
            <p>用户ID: ${userInfo.user_id}</p>
            <p>First Name: ${userInfo.first_name}</p>
            <p>Last Name: ${userInfo.last_name}</p>
            <p>用户是否允许机器人发送私信的布尔值: ${userInfo.allows_write_to_pm}</p>
            <p>hash值: ${userInfo.hash}</p>
            <p>auth_date授权日期的时间戳: ${userInfo.auth_date}</p>
            `;
        } else {
            userInfoElement.innerText = 'Not logged in';
        }

        // 获取用户信息并显示
        // const initDataUnsafe = window.Telegram.WebApp.initDataUnsafe;
        // const user = window.Telegram.WebApp.initDataUnsafe.user;
        // if (user) {
        //     // 如果用户信息存在，则显示用户信息
        //     const userInfoElement = document.getElementById('user-info');
        //     userInfoElement.innerHTML = `

        //         <p>query_id: ${initDataUnsafe.query_id}</p>

        //         <p>用户ID: ${user.id}</p>
        //         <p>First Name: ${user.first_name}</p>
        //         <p>Last Name: ${user.last_name}</p>
        //         <p>用户是否允许机器人发送私信的布尔值: ${user.allows_write_to_pm}</p>
        //         <p>hash值: ${initDataUnsafe.hash}</p>
        //         <p>auth_date授权日期的时间戳: ${initDataUnsafe.auth_date}</p>

        //     `;
        // } else {
        //     // 如果用户信息不存在，则显示未登录信息
        //     document.getElementById('user-info').innerText = 'Not logged in';
        // }
        // 当主题改变时，更新背景颜色
        // Telegram.WebApp.onEvent('themeChanged', function() {
        //     document.body.style.backgroundColor = Telegram.WebApp.backgroundColor;
        // });

        // // 设置并显示主按钮
        // Telegram.WebApp.MainButton.setParams({
        //     text: 'Restart Game'
        // });
        // Telegram.WebApp.MainButton.onClick(function () {
        //     restartGame(); // 当主按钮被点击时，重新开始游戏
        // });
        // Telegram.WebApp.MainButton.show(); // 显示主按钮

        // 加载现有的游戏脚本
        const script = document.createElement('script');
        script.src = 'js/script.js';
        document.body.appendChild(script);

        // 重新开始游戏函数
        function restartGame() {
            // 你的重新开始游戏逻辑
            document.querySelector('.game-over').style.display = 'none';
            document.querySelector('.game-ready').style.display = 'block';
            // 可能还需要调用你在 script.js 中的初始化或重置函数
        }

        // Telegram 登录回调函数
        // function onTelegramAuth(user) {
        //     alert('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');
        //     document.getElementById('telegram-login-container').style.display = 'none'; // 登录成功后隐藏登录按钮
        // }
    </script>
   
</body>
</html>
